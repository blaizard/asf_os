<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OS: flashc.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">flashc.c</div>  </div>
</div>
<div class="contents">
<a href="flashc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;avr32/io.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="compiler_8h.html" title="Commonly used includes, types and macros.">compiler.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="flashc_8h.html" title="FLASHC driver for AVR32 UC3.">flashc.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="unionu__avr32__flashc__fcr__t.html">00050</a> <span class="keyword">typedef</span> <span class="keyword">union </span>{
<a name="l00051"></a><a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">00051</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                 <a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>;
<a name="l00052"></a><a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">00052</a>     avr32_flashc_fcr_t            <a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">FCR</a>;
<a name="l00053"></a>00053 } <a class="code" href="unionu__avr32__flashc__fcr__t.html">u_avr32_flashc_fcr_t</a>;
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="unionu__avr32__flashc__fcmd__t.html">00055</a> <span class="keyword">typedef</span> <span class="keyword">union </span>{
<a name="l00056"></a><a class="code" href="unionu__avr32__flashc__fcmd__t.html#a6e34d6a9df4c1f26204d439fd5314700">00056</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                 <a class="code" href="unionu__avr32__flashc__fcmd__t.html#a6e34d6a9df4c1f26204d439fd5314700">fcmd</a>;
<a name="l00057"></a><a class="code" href="unionu__avr32__flashc__fcmd__t.html#a417db73c116267ff3545f9af41fac150">00057</a>     avr32_flashc_fcmd_t           <a class="code" href="unionu__avr32__flashc__fcmd__t.html#a417db73c116267ff3545f9af41fac150">FCMD</a>;
<a name="l00058"></a>00058 } <a class="code" href="unionu__avr32__flashc__fcmd__t.html">u_avr32_flashc_fcmd_t</a>;
<a name="l00059"></a>00059 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga8071c315b02d038c49fa0bf89a40ba1b">00068</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8071c315b02d038c49fa0bf89a40ba1b" title="Gets the size of the whole flash array.">flashc_get_flash_size</a>(<span class="keywordtype">void</span>)
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070 <span class="preprocessor">#if (AVR32_FLASHC_H_VERSION &gt;= 300)</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>    <span class="keyword">const</span> uint16_t FLASH_SIZE[] = {
<a name="l00072"></a>00072         4,
<a name="l00073"></a>00073         8,
<a name="l00074"></a>00074         16,
<a name="l00075"></a>00075         32,
<a name="l00076"></a>00076         48,
<a name="l00077"></a>00077         64,
<a name="l00078"></a>00078         96,
<a name="l00079"></a>00079         128,
<a name="l00080"></a>00080         192,
<a name="l00081"></a>00081         256,
<a name="l00082"></a>00082         384,
<a name="l00083"></a>00083         512,
<a name="l00084"></a>00084         768,
<a name="l00085"></a>00085         1024,
<a name="l00086"></a>00086         2048,
<a name="l00087"></a>00087     };
<a name="l00088"></a>00088     <span class="keywordflow">return</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)FLASH_SIZE[(AVR32_FLASHC.pr &amp; AVR32_FLASHC_PR_FSZ_MASK)
<a name="l00089"></a>00089             &gt;&gt; AVR32_FLASHC_PR_FSZ_OFFSET])&lt;&lt;10;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="preprocessor">#else // in older flashc version, FSZ is located in FSR register</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>    <span class="keyword">const</span> uint16_t FLASH_SIZE[] = {
<a name="l00093"></a>00093         32,
<a name="l00094"></a>00094         64,
<a name="l00095"></a>00095         128,
<a name="l00096"></a>00096         256,
<a name="l00097"></a>00097         384,
<a name="l00098"></a>00098         512,
<a name="l00099"></a>00099         768,
<a name="l00100"></a>00100         1024,
<a name="l00101"></a>00101     };
<a name="l00102"></a>00102     <span class="keywordflow">return</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)FLASH_SIZE[(AVR32_FLASHC.fsr &amp; AVR32_FLASHC_FSR_FSZ_MASK)
<a name="l00103"></a>00103             &gt;&gt; AVR32_FLASHC_FSR_FSZ_OFFSET]) &lt;&lt; 10;
<a name="l00104"></a>00104 <span class="preprocessor">#endif</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>}
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaafad0dcf645cc65acb5bc879558dac23">00108</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaafad0dcf645cc65acb5bc879558dac23" title="Gets the total number of pages in the flash array.">flashc_get_page_count</a>(<span class="keywordtype">void</span>)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8071c315b02d038c49fa0bf89a40ba1b" title="Gets the size of the whole flash array.">flashc_get_flash_size</a>() / AVR32_FLASHC_PAGE_SIZE;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga8910bcde3235e2af0770fbd2412b05bc">00114</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8910bcde3235e2af0770fbd2412b05bc" title="Gets the number of pages in each flash region.">flashc_get_page_count_per_region</a>(<span class="keywordtype">void</span>)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaafad0dcf645cc65acb5bc879558dac23" title="Gets the total number of pages in the flash array.">flashc_get_page_count</a>() / <a class="code" href="group__group__avr32__drivers__flashc.html#gaa70e373b96ff9c00883f284ca308e592" title="Number of flash regions defined by the FLASHC.">AVR32_FLASHC_REGIONS</a>;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gac5871dc98c8812b0413efd6456508999">00120</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gac5871dc98c8812b0413efd6456508999" title="Gets the region number of a page.">flashc_get_page_region</a>(<span class="keywordtype">int</span> page_number)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     <span class="keywordflow">return</span> ((page_number &gt;= 0) ? page_number
<a name="l00123"></a>00123             : <a class="code" href="group__group__avr32__drivers__flashc.html#gadb51a37e3153c24e5dd6cf06daac0e21" title="Gets the current FLASHC page number.">flashc_get_page_number</a>()) / <a class="code" href="group__group__avr32__drivers__flashc.html#ga8910bcde3235e2af0770fbd2412b05bc" title="Gets the number of pages in each flash region.">flashc_get_page_count_per_region</a>();
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga43b14107d406ea9025f8947490c9ddcd">00127</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga43b14107d406ea9025f8947490c9ddcd" title="Gets the number of the first page of a region.">flashc_get_region_first_page_number</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <span class="keywordflow">return</span> region * <a class="code" href="group__group__avr32__drivers__flashc.html#ga8910bcde3235e2af0770fbd2412b05bc" title="Gets the number of pages in each flash region.">flashc_get_page_count_per_region</a>();
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga52784dbdd246c6c320e5041026d4da08">00141</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga52784dbdd246c6c320e5041026d4da08" title="Gets the number of wait states of flash read accesses.">flashc_get_wait_state</a>(<span class="keywordtype">void</span>)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <span class="keywordflow">return</span> (AVR32_FLASHC.fcr &amp; AVR32_FLASHC_FCR_FWS_MASK) &gt;&gt; AVR32_FLASHC_FCR_FWS_OFFSET;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga2835c7ef58f410290ad530d34d7e8133">00147</a> <span class="keywordtype">void</span> <a class="code" href="pm__conf__clocks_8c.html#a2835c7ef58f410290ad530d34d7e8133">flashc_set_wait_state</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wait_state)
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149     <a class="code" href="unionu__avr32__flashc__fcr__t.html">u_avr32_flashc_fcr_t</a> u_avr32_flashc_fcr = {AVR32_FLASHC.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>};
<a name="l00150"></a>00150     u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">FCR</a>.fws = wait_state;
<a name="l00151"></a>00151     AVR32_FLASHC.fcr = u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga5dda977da7d7381b125b2fa25ef9ae90">00155</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga5dda977da7d7381b125b2fa25ef9ae90" title="Depending on the CPU frequency, set the wait states of flash read accesses.">flashc_set_bus_freq</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cpu_f_hz)
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (cpu_f_hz &gt;= AVR32_FLASHC_FWS_0_MAX_FREQ) {
<a name="l00158"></a>00158         <span class="comment">// Set 1 WS.</span>
<a name="l00159"></a>00159         <a class="code" href="pm__conf__clocks_8c.html#a2835c7ef58f410290ad530d34d7e8133">flashc_set_wait_state</a>(1);
<a name="l00160"></a>00160     } <span class="keywordflow">else</span> {
<a name="l00161"></a>00161         <span class="comment">// Set 0 WS.</span>
<a name="l00162"></a>00162         <a class="code" href="pm__conf__clocks_8c.html#a2835c7ef58f410290ad530d34d7e8133">flashc_set_wait_state</a>(0);
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gac3b57583a1683e980be72aec960bc42f">00166</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gac3b57583a1683e980be72aec960bc42f" title="Tells whether the Flash Ready interrupt is enabled.">flashc_is_ready_int_enabled</a>(<span class="keywordtype">void</span>)
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="keywordflow">return</span> ((AVR32_FLASHC.fcr &amp; AVR32_FLASHC_FCR_FRDY_MASK) != 0);
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gacb787828c6062e483c190500cad25193">00172</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gacb787828c6062e483c190500cad25193" title="Enables or disables the Flash Ready interrupt.">flashc_enable_ready_int</a>(<span class="keywordtype">bool</span> enable)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <a class="code" href="unionu__avr32__flashc__fcr__t.html">u_avr32_flashc_fcr_t</a> u_avr32_flashc_fcr = {AVR32_FLASHC.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>};
<a name="l00175"></a>00175     u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">FCR</a>.frdy = (enable != <span class="keyword">false</span>);
<a name="l00176"></a>00176     AVR32_FLASHC.fcr = u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaa55186e65b46eb60aa32901a410f3fc2">00180</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaa55186e65b46eb60aa32901a410f3fc2" title="Tells whether the Lock Error interrupt is enabled.">flashc_is_lock_error_int_enabled</a>(<span class="keywordtype">void</span>)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182     <span class="keywordflow">return</span> ((AVR32_FLASHC.fcr &amp; AVR32_FLASHC_FCR_LOCKE_MASK) != 0);
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga112d456e3ea093f9699aeb8fa7e818c1">00186</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga112d456e3ea093f9699aeb8fa7e818c1" title="Enables or disables the Lock Error interrupt.">flashc_enable_lock_error_int</a>(<span class="keywordtype">bool</span> enable)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188     <a class="code" href="unionu__avr32__flashc__fcr__t.html">u_avr32_flashc_fcr_t</a> u_avr32_flashc_fcr = {AVR32_FLASHC.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>};
<a name="l00189"></a>00189     u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">FCR</a>.locke = (enable != <span class="keyword">false</span>);
<a name="l00190"></a>00190     AVR32_FLASHC.fcr = u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga5050d8497779a0e24ac74689597834c2">00194</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga5050d8497779a0e24ac74689597834c2" title="Tells whether the Programming Error interrupt is enabled.">flashc_is_prog_error_int_enabled</a>(<span class="keywordtype">void</span>)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keywordflow">return</span> ((AVR32_FLASHC.fcr &amp; AVR32_FLASHC_FCR_PROGE_MASK) != 0);
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga432b5d4f0d90ca9facba780d99f08ae9">00200</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga432b5d4f0d90ca9facba780d99f08ae9" title="Enables or disables the Programming Error interrupt.">flashc_enable_prog_error_int</a>(<span class="keywordtype">bool</span> enable)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <a class="code" href="unionu__avr32__flashc__fcr__t.html">u_avr32_flashc_fcr_t</a> u_avr32_flashc_fcr = {AVR32_FLASHC.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>};
<a name="l00203"></a>00203     u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#aa8f3a48553db579f2272c10a5ad2c710">FCR</a>.proge = (enable != <span class="keyword">false</span>);
<a name="l00204"></a>00204     AVR32_FLASHC.fcr = u_avr32_flashc_fcr.<a class="code" href="unionu__avr32__flashc__fcr__t.html#a4931f45cdf8856a36fd6670033cfbe99">fcr</a>;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gadda694b46dcd563dab0c4be794dd2060">00216</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gadda694b46dcd563dab0c4be794dd2060" title="Tells whether the FLASHC is ready to run a new command.">flashc_is_ready</a>(<span class="keywordtype">void</span>)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <span class="keywordflow">return</span> ((AVR32_FLASHC.fsr &amp; AVR32_FLASHC_FSR_FRDY_MASK) != 0);
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaca88002d64a494ca5b796b592834369d">00222</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaca88002d64a494ca5b796b592834369d" title="Waits actively until the FLASHC is ready to run a new command.">flashc_default_wait_until_ready</a>(<span class="keywordtype">void</span>)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224     <span class="keywordflow">while</span> (!<a class="code" href="group__group__avr32__drivers__flashc.html#gadda694b46dcd563dab0c4be794dd2060" title="Tells whether the FLASHC is ready to run a new command.">flashc_is_ready</a>());
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga180c9966f5242650e00e4a231956acec">00228</a> void (*<span class="keyword">volatile</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga180c9966f5242650e00e4a231956acec" title="Pointer to the function used by the driver when it needs to wait until the FLASHC is ready to run a n...">flashc_wait_until_ready</a>)(void) = <a class="code" href="group__group__avr32__drivers__flashc.html#gaca88002d64a494ca5b796b592834369d" title="Waits actively until the FLASHC is ready to run a new command.">flashc_default_wait_until_ready</a>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00241"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gae7d38c60001d5d8d00363a6cb07f89f0">00241</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gae7d38c60001d5d8d00363a6cb07f89f0" title="Gets the error status of the FLASHC.">flashc_get_error_status</a>(<span class="keywordtype">void</span>)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243     <span class="keywordflow">return</span> AVR32_FLASHC.fsr &amp; (AVR32_FLASHC_FSR_LOCKE_MASK |
<a name="l00244"></a>00244             AVR32_FLASHC_FSR_PROGE_MASK);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00252"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be">00252</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = 0;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gabc9239c2bde687eb3324d2d839493b4e">00255</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gabc9239c2bde687eb3324d2d839493b4e" title="Tells whether a Lock Error has occurred during the last function called that issued one or more FLASH...">flashc_is_lock_error</a>(<span class="keywordtype">void</span>)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <span class="keywordflow">return</span> ((<a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> &amp; AVR32_FLASHC_FSR_LOCKE_MASK) != 0);
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga96f2a8ec38721359b09bb9214c025b7f">00261</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga96f2a8ec38721359b09bb9214c025b7f" title="Tells whether a Programming Error has occurred during the last function called that issued one or mor...">flashc_is_programming_error</a>(<span class="keywordtype">void</span>)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <span class="keywordflow">return</span> ((<a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> &amp; AVR32_FLASHC_FSR_PROGE_MASK) != 0);
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga36519235197ff4d6ab7f5adcb3fce6c1">00275</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga36519235197ff4d6ab7f5adcb3fce6c1" title="Gets the last issued FLASHC command.">flashc_get_command</a>(<span class="keywordtype">void</span>)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     <span class="keywordflow">return</span> (AVR32_FLASHC.fcmd &amp; AVR32_FLASHC_FCMD_CMD_MASK) &gt;&gt; AVR32_FLASHC_FCMD_CMD_OFFSET;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gadb51a37e3153c24e5dd6cf06daac0e21">00281</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gadb51a37e3153c24e5dd6cf06daac0e21" title="Gets the current FLASHC page number.">flashc_get_page_number</a>(<span class="keywordtype">void</span>)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <span class="keywordflow">return</span> (AVR32_FLASHC.fcmd &amp; AVR32_FLASHC_FCMD_PAGEN_MASK) &gt;&gt; AVR32_FLASHC_FCMD_PAGEN_OFFSET;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11">00287</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> command, <span class="keywordtype">int</span> page_number)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289     <a class="code" href="unionu__avr32__flashc__fcmd__t.html">u_avr32_flashc_fcmd_t</a> u_avr32_flashc_fcmd;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <a class="code" href="group__group__avr32__drivers__flashc.html#ga180c9966f5242650e00e4a231956acec" title="Pointer to the function used by the driver when it needs to wait until the FLASHC is ready to run a n...">flashc_wait_until_ready</a>();
<a name="l00292"></a>00292     u_avr32_flashc_fcmd.<a class="code" href="unionu__avr32__flashc__fcmd__t.html#a6e34d6a9df4c1f26204d439fd5314700">fcmd</a> = AVR32_FLASHC.fcmd;
<a name="l00293"></a>00293     u_avr32_flashc_fcmd.<a class="code" href="unionu__avr32__flashc__fcmd__t.html#a417db73c116267ff3545f9af41fac150">FCMD</a>.cmd = command;
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (page_number &gt;= 0) {
<a name="l00295"></a>00295         u_avr32_flashc_fcmd.<a class="code" href="unionu__avr32__flashc__fcmd__t.html#a417db73c116267ff3545f9af41fac150">FCMD</a>.pagen = page_number;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     u_avr32_flashc_fcmd.<a class="code" href="unionu__avr32__flashc__fcmd__t.html#a417db73c116267ff3545f9af41fac150">FCMD</a>.key = AVR32_FLASHC_FCMD_KEY_KEY;
<a name="l00298"></a>00298     AVR32_FLASHC.fcmd = u_avr32_flashc_fcmd.<a class="code" href="unionu__avr32__flashc__fcmd__t.html#a6e34d6a9df4c1f26204d439fd5314700">fcmd</a>;
<a name="l00299"></a>00299     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = <a class="code" href="group__group__avr32__drivers__flashc.html#gae7d38c60001d5d8d00363a6cb07f89f0" title="Gets the error status of the FLASHC.">flashc_get_error_status</a>();
<a name="l00300"></a>00300     <a class="code" href="group__group__avr32__drivers__flashc.html#ga180c9966f5242650e00e4a231956acec" title="Pointer to the function used by the driver when it needs to wait until the FLASHC is ready to run a n...">flashc_wait_until_ready</a>();
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaac955da1ba0b0833d17d3068c34222ec">00312</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaac955da1ba0b0833d17d3068c34222ec" title="Issues a No Operation command to the FLASHC.">flashc_no_operation</a>(<span class="keywordtype">void</span>)
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_NOP, -1);
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga56f654a36c20b651412bbb689b8a4b2c">00318</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga56f654a36c20b651412bbb689b8a4b2c" title="Issues an Erase All command to the FLASHC.">flashc_erase_all</a>(<span class="keywordtype">void</span>)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_EA, -1);
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gab07cd7525d8cdfad6c4c563310cddee2">00332</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gab07cd7525d8cdfad6c4c563310cddee2" title="Tells whether the Security bit is active.">flashc_is_security_bit_active</a>(<span class="keywordtype">void</span>)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334     <span class="keywordflow">return</span> ((AVR32_FLASHC.fsr &amp; AVR32_FLASHC_FSR_SECURITY_MASK) != 0);
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga245cc33e09bc45b78d4fdc189ba6fd85">00338</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga245cc33e09bc45b78d4fdc189ba6fd85" title="Activates the Security bit.">flashc_activate_security_bit</a>(<span class="keywordtype">void</span>)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_SSB, -1);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga83ed88a41076163bd29ca80d30cb094f">00344</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga83ed88a41076163bd29ca80d30cb094f" title="Gets the bootloader protected size.">flashc_get_bootloader_protected_size</a>(<span class="keywordtype">void</span>)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bootprot = (1 &lt;&lt; AVR32_FLASHC_FGPFRLO_BOOTPROT_SIZE) - 1 -
<a name="l00347"></a>00347             <a class="code" href="group__group__avr32__drivers__flashc.html#ga48db4e70ec0449ea94c9c92643c26d8e" title="Reads a general-purpose fuse bit-field.">flashc_read_gp_fuse_bitfield</a>(AVR32_FLASHC_FGPFRLO_BOOTPROT_OFFSET,
<a name="l00348"></a>00348             AVR32_FLASHC_FGPFRLO_BOOTPROT_SIZE);
<a name="l00349"></a>00349     <span class="keywordflow">return</span> (bootprot) ? AVR32_FLASHC_PAGE_SIZE &lt;&lt; bootprot : 0;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00353"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga076a1b22c9f3e6dad1739f0398f89b37">00353</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga076a1b22c9f3e6dad1739f0398f89b37" title="Sets the bootloader protected size.">flashc_set_bootloader_protected_size</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bootprot_size)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355     <a class="code" href="group__group__avr32__drivers__flashc.html#gaeef87beafc415e3a116072f74845d7ab" title="Sets a general-purpose fuse bit-field with the appropriate erase and write operations.">flashc_set_gp_fuse_bitfield</a>(AVR32_FLASHC_FGPFRLO_BOOTPROT_OFFSET,
<a name="l00356"></a>00356             AVR32_FLASHC_FGPFRLO_BOOTPROT_SIZE,
<a name="l00357"></a>00357             (1 &lt;&lt; AVR32_FLASHC_FGPFRLO_BOOTPROT_SIZE) - 1 -
<a name="l00358"></a>00358             ((bootprot_size) ?
<a name="l00359"></a>00359             32 - <a class="code" href="compiler_8h.html#a004f88903a09b9c23017e697eaf5a845" title="Counts the leading zero bits of the given value considered as a 32-bit integer.">clz</a>((((<a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>(<a class="code" href="compiler_8h.html#affe776513b24d84b39af8ab0930fef7f" title="Takes the maximal value of a and b.">max</a>(bootprot_size, AVR32_FLASHC_PAGE_SIZE &lt;&lt; 1),
<a name="l00360"></a>00360             AVR32_FLASHC_PAGE_SIZE &lt;&lt;
<a name="l00361"></a>00361             ((1 &lt;&lt; AVR32_FLASHC_FGPFRLO_BOOTPROT_SIZE) - 1)) +
<a name="l00362"></a>00362             AVR32_FLASHC_PAGE_SIZE - 1) /
<a name="l00363"></a>00363             AVR32_FLASHC_PAGE_SIZE) &lt;&lt; 1) - 1) - 1 :
<a name="l00364"></a>00364             0));
<a name="l00365"></a>00365     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga83ed88a41076163bd29ca80d30cb094f" title="Gets the bootloader protected size.">flashc_get_bootloader_protected_size</a>();
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gae5d2a26e4f0666cc2ed260feb528a560">00369</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gae5d2a26e4f0666cc2ed260feb528a560" title="Tells whether external privileged fetch is locked.">flashc_is_external_privileged_fetch_locked</a>(<span class="keywordtype">void</span>)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371     <span class="keywordflow">return</span> (!<a class="code" href="group__group__avr32__drivers__flashc.html#ga41488c15448086169266af4936ea7926" title="Reads a general-purpose fuse bit.">flashc_read_gp_fuse_bit</a>(AVR32_FLASHC_FGPFRLO_EPFL_OFFSET));
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga97c8b9ed8f952803a3911af33ba8d553">00375</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga97c8b9ed8f952803a3911af33ba8d553" title="Locks or unlocks external privileged fetch.">flashc_lock_external_privileged_fetch</a>(<span class="keywordtype">bool</span> lock)
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <a class="code" href="group__group__avr32__drivers__flashc.html#ga63c172f89cfe0f3e3cf1c6eadc62f5f5" title="Sets a general-purpose fuse bit with the appropriate erase and write operations.">flashc_set_gp_fuse_bit</a>(AVR32_FLASHC_FGPFRLO_EPFL_OFFSET, !lock);
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga50d3b06a3a82ba1e7c56193c3c24f7ef">00381</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga50d3b06a3a82ba1e7c56193c3c24f7ef" title="Tells whether the region of a page is locked.">flashc_is_page_region_locked</a>(<span class="keywordtype">int</span> page_number)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga152b45f38eafcf708e52df5a814d048e" title="Tells whether a region is locked.">flashc_is_region_locked</a>(<a class="code" href="group__group__avr32__drivers__flashc.html#gac5871dc98c8812b0413efd6456508999" title="Gets the region number of a page.">flashc_get_page_region</a>(page_number));
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga152b45f38eafcf708e52df5a814d048e">00387</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga152b45f38eafcf708e52df5a814d048e" title="Tells whether a region is locked.">flashc_is_region_locked</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region)
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <span class="keywordflow">return</span> ((AVR32_FLASHC.fsr &amp; AVR32_FLASHC_FSR_LOCK0_MASK &lt;&lt; (region &amp; (<a class="code" href="group__group__avr32__drivers__flashc.html#gaa70e373b96ff9c00883f284ca308e592" title="Number of flash regions defined by the FLASHC.">AVR32_FLASHC_REGIONS</a> - 1))) != 0);
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga4bc67adcf6690cc7e83fd42560a5e526">00393</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga4bc67adcf6690cc7e83fd42560a5e526" title="Locks or unlocks the region of a page.">flashc_lock_page_region</a>(<span class="keywordtype">int</span> page_number, <span class="keywordtype">bool</span> lock)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>((lock) ? AVR32_FLASHC_FCMD_CMD_LP : AVR32_FLASHC_FCMD_CMD_UP, page_number);
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaefc77ff29ddc03fa5e605acd7f9eeb7c">00399</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaefc77ff29ddc03fa5e605acd7f9eeb7c" title="Locks or unlocks a region.">flashc_lock_region</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region, <span class="keywordtype">bool</span> lock)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <a class="code" href="group__group__avr32__drivers__flashc.html#ga4bc67adcf6690cc7e83fd42560a5e526" title="Locks or unlocks the region of a page.">flashc_lock_page_region</a>(<a class="code" href="group__group__avr32__drivers__flashc.html#ga43b14107d406ea9025f8947490c9ddcd" title="Gets the number of the first page of a region.">flashc_get_region_first_page_number</a>(region), lock);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga8ec3c05f8b1a620a5014e2c066b7f0bf">00405</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8ec3c05f8b1a620a5014e2c066b7f0bf" title="Locks or unlocks all regions.">flashc_lock_all_regions</a>(<span class="keywordtype">bool</span> lock)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00408"></a>00408     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region = <a class="code" href="group__group__avr32__drivers__flashc.html#gaa70e373b96ff9c00883f284ca308e592" title="Number of flash regions defined by the FLASHC.">AVR32_FLASHC_REGIONS</a>;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keywordflow">while</span> (region) {
<a name="l00411"></a>00411         <a class="code" href="group__group__avr32__drivers__flashc.html#gaefc77ff29ddc03fa5e605acd7f9eeb7c" title="Locks or unlocks a region.">flashc_lock_region</a>(--region, lock);
<a name="l00412"></a>00412         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga41488c15448086169266af4936ea7926">00426</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga41488c15448086169266af4936ea7926" title="Reads a general-purpose fuse bit.">flashc_read_gp_fuse_bit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428     <span class="keywordflow">return</span> ((<a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>() &amp; 1ULL &lt;&lt; (gp_fuse_bit &amp; 0x3F)) != 0);
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga48db4e70ec0449ea94c9c92643c26d8e">00432</a> uint64_t <a class="code" href="group__group__avr32__drivers__flashc.html#ga48db4e70ec0449ea94c9c92643c26d8e" title="Reads a general-purpose fuse bit-field.">flashc_read_gp_fuse_bitfield</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>() &gt;&gt; (pos &amp; 0x3F) &amp; ((1ULL &lt;&lt; <a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>(width, 64)) - 1);
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga86b9023e1160178df2f46aff4dfddda3">00438</a> uint8_t <a class="code" href="group__group__avr32__drivers__flashc.html#ga86b9023e1160178df2f46aff4dfddda3" title="Reads a general-purpose fuse byte.">flashc_read_gp_fuse_byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_byte)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>() &gt;&gt; ((gp_fuse_byte &amp; 0x07) &lt;&lt; 3);
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554">00444</a> uint64_t <a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>(<span class="keywordtype">void</span>)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <span class="keywordflow">return</span> AVR32_FLASHC.fgpfrlo | (uint64_t)AVR32_FLASHC.fgpfrhi &lt;&lt; 32;
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00450"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gac5454efcadb99899bfe075b463a2e6dd">00450</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gac5454efcadb99899bfe075b463a2e6dd" title="Erases a general-purpose fuse bit.">flashc_erase_gp_fuse_bit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit, <span class="keywordtype">bool</span> check)
<a name="l00451"></a>00451 {
<a name="l00452"></a>00452     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_EGPB, gp_fuse_bit &amp; 0x3F);
<a name="l00453"></a>00453     <span class="keywordflow">return</span> (check) ? <a class="code" href="group__group__avr32__drivers__flashc.html#ga41488c15448086169266af4936ea7926" title="Reads a general-purpose fuse bit.">flashc_read_gp_fuse_bit</a>(gp_fuse_bit) : <span class="keyword">true</span>;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga840a6f529e33adbd3759f276a0255aee">00457</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga840a6f529e33adbd3759f276a0255aee" title="Erases a general-purpose fuse bit-field.">flashc_erase_gp_fuse_bitfield</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width, <span class="keywordtype">bool</span> check)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00460"></a>00460     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     pos &amp;= 0x3F;
<a name="l00463"></a>00463     width = <a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>(width, 64);
<a name="l00464"></a>00464     <span class="keywordflow">for</span> (gp_fuse_bit = pos; gp_fuse_bit &lt; pos + width; gp_fuse_bit++) {
<a name="l00465"></a>00465         <a class="code" href="group__group__avr32__drivers__flashc.html#gac5454efcadb99899bfe075b463a2e6dd" title="Erases a general-purpose fuse bit.">flashc_erase_gp_fuse_bit</a>(gp_fuse_bit, <span class="keyword">false</span>);
<a name="l00466"></a>00466         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00469"></a>00469     <span class="keywordflow">return</span> (check) ? (<a class="code" href="group__group__avr32__drivers__flashc.html#ga48db4e70ec0449ea94c9c92643c26d8e" title="Reads a general-purpose fuse bit-field.">flashc_read_gp_fuse_bitfield</a>(pos, width) == (1ULL &lt;&lt; width) - 1) : <span class="keyword">true</span>;
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gacb14ac40b939a0804e8e72a8d58f5f68">00473</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gacb14ac40b939a0804e8e72a8d58f5f68" title="Erases a general-purpose fuse byte.">flashc_erase_gp_fuse_byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_byte, <span class="keywordtype">bool</span> check)
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status;
<a name="l00476"></a>00476     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> current_gp_fuse_byte;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     uint64_t value = <a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>();
<a name="l00479"></a>00479     <a class="code" href="group__group__avr32__drivers__flashc.html#ga59b9644a7f13bc4e510bdac498b27fb5" title="Erases all general-purpose fuses.">flashc_erase_all_gp_fuses</a>(<span class="keyword">false</span>);
<a name="l00480"></a>00480     error_status = <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordflow">for</span> (current_gp_fuse_byte = 0; current_gp_fuse_byte &lt; 8; current_gp_fuse_byte++, value &gt;&gt;= 8) {
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (current_gp_fuse_byte != gp_fuse_byte) {
<a name="l00484"></a>00484             <a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc" title="Writes a general-purpose fuse byte.">flashc_write_gp_fuse_byte</a>(current_gp_fuse_byte, value);
<a name="l00485"></a>00485             error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00489"></a>00489     <span class="keywordflow">return</span> (check) ? (<a class="code" href="group__group__avr32__drivers__flashc.html#ga86b9023e1160178df2f46aff4dfddda3" title="Reads a general-purpose fuse byte.">flashc_read_gp_fuse_byte</a>(gp_fuse_byte) == 0xFF) : <span class="keyword">true</span>;
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 
<a name="l00493"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga59b9644a7f13bc4e510bdac498b27fb5">00493</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga59b9644a7f13bc4e510bdac498b27fb5" title="Erases all general-purpose fuses.">flashc_erase_all_gp_fuses</a>(<span class="keywordtype">bool</span> check)
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_EAGPF, -1);
<a name="l00496"></a>00496     <span class="keywordflow">return</span> (check) ? (<a class="code" href="group__group__avr32__drivers__flashc.html#gabdba94fb9eb09177ced3df0ad80b1554" title="Reads all general-purpose fuses.">flashc_read_all_gp_fuses</a>() == 0xFFFFFFFFFFFFFFFFULL) : <span class="keyword">true</span>;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga70af318e71334255931a6638d2fa693c">00500</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga70af318e71334255931a6638d2fa693c" title="Writes a general-purpose fuse bit.">flashc_write_gp_fuse_bit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit, <span class="keywordtype">bool</span> value)
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (!value) {
<a name="l00503"></a>00503         <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_WGPB, gp_fuse_bit &amp; 0x3F);
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga7bc0b63b79ad5809f7d68b2da7e5e866">00508</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga7bc0b63b79ad5809f7d68b2da7e5e866" title="Writes a general-purpose fuse bit-field.">flashc_write_gp_fuse_bitfield</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width, uint64_t value)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00511"></a>00511     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     pos &amp;= 0x3F;
<a name="l00514"></a>00514     width = <a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>(width, 64);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (gp_fuse_bit = pos; gp_fuse_bit &lt; pos + width; gp_fuse_bit++, value &gt;&gt;= 1) {
<a name="l00517"></a>00517         <a class="code" href="group__group__avr32__drivers__flashc.html#ga70af318e71334255931a6638d2fa693c" title="Writes a general-purpose fuse bit.">flashc_write_gp_fuse_bit</a>(gp_fuse_bit, value &amp; 0x01);
<a name="l00518"></a>00518         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc">00525</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc" title="Writes a general-purpose fuse byte.">flashc_write_gp_fuse_byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_byte, uint8_t value)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_PGPFB, (gp_fuse_byte &amp; 0x07) | value &lt;&lt; 3);
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga39415e6bf815ab6bc734bf1e1cfe3bed">00531</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga39415e6bf815ab6bc734bf1e1cfe3bed" title="Writes all general-purpose fuses.">flashc_write_all_gp_fuses</a>(uint64_t value)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00534"></a>00534     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_byte;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     <span class="keywordflow">for</span> (gp_fuse_byte = 0; gp_fuse_byte &lt; 8; gp_fuse_byte++, value &gt;&gt;= 8) {
<a name="l00537"></a>00537         <a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc" title="Writes a general-purpose fuse byte.">flashc_write_gp_fuse_byte</a>(gp_fuse_byte, value);
<a name="l00538"></a>00538         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga63c172f89cfe0f3e3cf1c6eadc62f5f5">00545</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga63c172f89cfe0f3e3cf1c6eadc62f5f5" title="Sets a general-purpose fuse bit with the appropriate erase and write operations.">flashc_set_gp_fuse_bit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit, <span class="keywordtype">bool</span> value)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (value) {
<a name="l00548"></a>00548         <a class="code" href="group__group__avr32__drivers__flashc.html#gac5454efcadb99899bfe075b463a2e6dd" title="Erases a general-purpose fuse bit.">flashc_erase_gp_fuse_bit</a>(gp_fuse_bit, <span class="keyword">false</span>);
<a name="l00549"></a>00549     } <span class="keywordflow">else</span> {
<a name="l00550"></a>00550         <a class="code" href="group__group__avr32__drivers__flashc.html#ga70af318e71334255931a6638d2fa693c" title="Writes a general-purpose fuse bit.">flashc_write_gp_fuse_bit</a>(gp_fuse_bit, <span class="keyword">false</span>);
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaeef87beafc415e3a116072f74845d7ab">00555</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaeef87beafc415e3a116072f74845d7ab" title="Sets a general-purpose fuse bit-field with the appropriate erase and write operations.">flashc_set_gp_fuse_bitfield</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width, uint64_t value)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00558"></a>00558     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_bit;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     pos &amp;= 0x3F;
<a name="l00561"></a>00561     width = <a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>(width, 64);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="keywordflow">for</span> (gp_fuse_bit = pos; gp_fuse_bit &lt; pos + width; gp_fuse_bit++, value &gt;&gt;= 1) {
<a name="l00564"></a>00564         <a class="code" href="group__group__avr32__drivers__flashc.html#ga63c172f89cfe0f3e3cf1c6eadc62f5f5" title="Sets a general-purpose fuse bit with the appropriate erase and write operations.">flashc_set_gp_fuse_bit</a>(gp_fuse_bit, value &amp; 0x01);
<a name="l00565"></a>00565         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gafb6970fabde5991a634954229fb4e5ca">00572</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gafb6970fabde5991a634954229fb4e5ca" title="Sets a general-purpose fuse byte with the appropriate erase and write operations.">flashc_set_gp_fuse_byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gp_fuse_byte, uint8_t value)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     <span class="keywordflow">switch</span> (value) {
<a name="l00577"></a>00577     <span class="keywordflow">case</span> 0xFF:
<a name="l00578"></a>00578         <a class="code" href="group__group__avr32__drivers__flashc.html#gacb14ac40b939a0804e8e72a8d58f5f68" title="Erases a general-purpose fuse byte.">flashc_erase_gp_fuse_byte</a>(gp_fuse_byte, <span class="keyword">false</span>);
<a name="l00579"></a>00579         <span class="keywordflow">break</span>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="keywordflow">case</span> 0x00:
<a name="l00582"></a>00582         <a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc" title="Writes a general-purpose fuse byte.">flashc_write_gp_fuse_byte</a>(gp_fuse_byte, 0x00);
<a name="l00583"></a>00583         <span class="keywordflow">break</span>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">default</span>:
<a name="l00586"></a>00586         <a class="code" href="group__group__avr32__drivers__flashc.html#gacb14ac40b939a0804e8e72a8d58f5f68" title="Erases a general-purpose fuse byte.">flashc_erase_gp_fuse_byte</a>(gp_fuse_byte, <span class="keyword">false</span>);
<a name="l00587"></a>00587         error_status = <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00588"></a>00588         <a class="code" href="group__group__avr32__drivers__flashc.html#gacd1a7d62446687fe6db36f4ff35e7cbc" title="Writes a general-purpose fuse byte.">flashc_write_gp_fuse_byte</a>(gp_fuse_byte, value);
<a name="l00589"></a>00589         <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> |= error_status;
<a name="l00590"></a>00590         <span class="keywordflow">break</span>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 
<a name="l00595"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga65d5726797f7216ce80969b7349c7902">00595</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga65d5726797f7216ce80969b7349c7902" title="Sets all general-purpose fuses with the appropriate erase and write operations.">flashc_set_all_gp_fuses</a>(uint64_t value)
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="keywordflow">switch</span> (value) {
<a name="l00600"></a>00600     <span class="keywordflow">case</span> 0xFFFFFFFFFFFFFFFFULL:
<a name="l00601"></a>00601         <a class="code" href="group__group__avr32__drivers__flashc.html#ga59b9644a7f13bc4e510bdac498b27fb5" title="Erases all general-purpose fuses.">flashc_erase_all_gp_fuses</a>(<span class="keyword">false</span>);
<a name="l00602"></a>00602         <span class="keywordflow">break</span>;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="keywordflow">case</span> 0x0000000000000000ULL:
<a name="l00605"></a>00605         <a class="code" href="group__group__avr32__drivers__flashc.html#ga39415e6bf815ab6bc734bf1e1cfe3bed" title="Writes all general-purpose fuses.">flashc_write_all_gp_fuses</a>(0x0000000000000000ULL);
<a name="l00606"></a>00606         <span class="keywordflow">break</span>;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="keywordflow">default</span>:
<a name="l00609"></a>00609         <a class="code" href="group__group__avr32__drivers__flashc.html#ga59b9644a7f13bc4e510bdac498b27fb5" title="Erases all general-purpose fuses.">flashc_erase_all_gp_fuses</a>(<span class="keyword">false</span>);
<a name="l00610"></a>00610         error_status = <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00611"></a>00611         <a class="code" href="group__group__avr32__drivers__flashc.html#ga39415e6bf815ab6bc734bf1e1cfe3bed" title="Writes all general-purpose fuses.">flashc_write_all_gp_fuses</a>(value);
<a name="l00612"></a>00612         <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> |= error_status;
<a name="l00613"></a>00613         <span class="keywordflow">break</span>;
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 
<a name="l00626"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaffafe9cb74731d817b721d2a52093412">00626</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaffafe9cb74731d817b721d2a52093412" title="Clears the page buffer.">flashc_clear_page_buffer</a>(<span class="keywordtype">void</span>)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_CPB, -1);
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga05a9c2063e643943bae09f0786bcc063">00632</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga05a9c2063e643943bae09f0786bcc063" title="Tells whether the page to which the last Quick Page Read or Quick Page Read User Page command was app...">flashc_is_page_erased</a>(<span class="keywordtype">void</span>)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <span class="keywordflow">return</span> ((AVR32_FLASHC.fsr &amp; AVR32_FLASHC_FSR_QPRR_MASK) != 0);
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga078a084303b02d665fe3779bc096a150">00638</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga078a084303b02d665fe3779bc096a150" title="Applies the Quick Page Read command to a page.">flashc_quick_page_read</a>(<span class="keywordtype">int</span> page_number)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_QPR, page_number);
<a name="l00641"></a>00641     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga05a9c2063e643943bae09f0786bcc063" title="Tells whether the page to which the last Quick Page Read or Quick Page Read User Page command was app...">flashc_is_page_erased</a>();
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga8bd196144d3485a9b50b7c5fffc9fab2">00645</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga8bd196144d3485a9b50b7c5fffc9fab2" title="Erases a page.">flashc_erase_page</a>(<span class="keywordtype">int</span> page_number, <span class="keywordtype">bool</span> check)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647     <span class="keywordtype">bool</span> page_erased = <span class="keyword">true</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_EP, page_number);
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (check) {
<a name="l00651"></a>00651         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00652"></a>00652         page_erased = <a class="code" href="group__group__avr32__drivers__flashc.html#ga078a084303b02d665fe3779bc096a150" title="Applies the Quick Page Read command to a page.">flashc_quick_page_read</a>(-1);
<a name="l00653"></a>00653         <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> |= error_status;
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655     <span class="keywordflow">return</span> page_erased;
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 
<a name="l00659"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gabff832a6e31c349197439da831d71b7d">00659</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gabff832a6e31c349197439da831d71b7d" title="Erases all pages within the flash array.">flashc_erase_all_pages</a>(<span class="keywordtype">bool</span> check)
<a name="l00660"></a>00660 {
<a name="l00661"></a>00661     <span class="keywordtype">bool</span> all_pages_erased = <span class="keyword">true</span>;
<a name="l00662"></a>00662     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00663"></a>00663     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> page_number = <a class="code" href="group__group__avr32__drivers__flashc.html#gaafad0dcf645cc65acb5bc879558dac23" title="Gets the total number of pages in the flash array.">flashc_get_page_count</a>();
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     <span class="keywordflow">while</span> (page_number) {
<a name="l00666"></a>00666         all_pages_erased &amp;= <a class="code" href="group__group__avr32__drivers__flashc.html#ga8bd196144d3485a9b50b7c5fffc9fab2" title="Erases a page.">flashc_erase_page</a>(--page_number, check);
<a name="l00667"></a>00667         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00670"></a>00670     <span class="keywordflow">return</span> all_pages_erased;
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 
<a name="l00674"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gaa10438433246139bee71da6db2bb5bd5">00674</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaa10438433246139bee71da6db2bb5bd5" title="Writes a page from the page buffer.">flashc_write_page</a>(<span class="keywordtype">int</span> page_number)
<a name="l00675"></a>00675 {
<a name="l00676"></a>00676     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_WP, page_number);
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 
<a name="l00680"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga1921803f9ba1d21a7926d9dafc400f36">00680</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga1921803f9ba1d21a7926d9dafc400f36" title="Issues a Quick Page Read User Page command to the FLASHC.">flashc_quick_user_page_read</a>(<span class="keywordtype">void</span>)
<a name="l00681"></a>00681 {
<a name="l00682"></a>00682     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_QPRUP, -1);
<a name="l00683"></a>00683     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga05a9c2063e643943bae09f0786bcc063" title="Tells whether the page to which the last Quick Page Read or Quick Page Read User Page command was app...">flashc_is_page_erased</a>();
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 
<a name="l00687"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga7160c001cada0a9a0162cac2305a9038">00687</a> <span class="keywordtype">bool</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga7160c001cada0a9a0162cac2305a9038" title="Erases the User page.">flashc_erase_user_page</a>(<span class="keywordtype">bool</span> check)
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_EUP, -1);
<a name="l00690"></a>00690     <span class="keywordflow">return</span> (check) ? <a class="code" href="group__group__avr32__drivers__flashc.html#ga1921803f9ba1d21a7926d9dafc400f36" title="Issues a Quick Page Read User Page command to the FLASHC.">flashc_quick_user_page_read</a>() : <span class="keyword">true</span>;
<a name="l00691"></a>00691 }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 
<a name="l00694"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gad04374b721dca9c534d7cd041ae24712">00694</a> <span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gad04374b721dca9c534d7cd041ae24712" title="Writes the User page from the page buffer.">flashc_write_user_page</a>(<span class="keywordtype">void</span>)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_WUP, -1);
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 
<a name="l00700"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga9157e8cdcd527943f8284c0de37cd91a">00700</a> <span class="keyword">volatile</span> <span class="keywordtype">void</span> *<a class="code" href="group__group__avr32__drivers__flashc.html#ga9157e8cdcd527943f8284c0de37cd91a" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src source byte...">flashc_memset8</a>(<span class="keyword">volatile</span> <span class="keywordtype">void</span> *dst, uint8_t src, <span class="keywordtype">size_t</span> nbytes, <span class="keywordtype">bool</span> erase)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gad9b00f6e409b0b38924dba961bd52145" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset16</a>(dst, src | (uint16_t)src &lt;&lt; 8, nbytes, erase);
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="group__group__avr32__drivers__flashc.html#gad9b00f6e409b0b38924dba961bd52145">00706</a> <span class="keyword">volatile</span> <span class="keywordtype">void</span> *<a class="code" href="group__group__avr32__drivers__flashc.html#gad9b00f6e409b0b38924dba961bd52145" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset16</a>(<span class="keyword">volatile</span> <span class="keywordtype">void</span> *dst, uint16_t src, <span class="keywordtype">size_t</span> nbytes, <span class="keywordtype">bool</span> erase)
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga44e771a3f7ed3728ef366cf2a8b67592" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset32</a>(dst, src | (uint32_t)src &lt;&lt; 16, nbytes, erase);
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga44e771a3f7ed3728ef366cf2a8b67592">00712</a> <span class="keyword">volatile</span> <span class="keywordtype">void</span> *<a class="code" href="group__group__avr32__drivers__flashc.html#ga44e771a3f7ed3728ef366cf2a8b67592" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset32</a>(<span class="keyword">volatile</span> <span class="keywordtype">void</span> *dst, uint32_t src, <span class="keywordtype">size_t</span> nbytes, <span class="keywordtype">bool</span> erase)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714     <span class="keywordflow">return</span> <a class="code" href="group__group__avr32__drivers__flashc.html#ga9ab40621c7f4c7372cb3147c014d7d27" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset64</a>(dst, src | (uint64_t)src &lt;&lt; 32, nbytes, erase);
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 
<a name="l00718"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga9ab40621c7f4c7372cb3147c014d7d27">00718</a> <span class="keyword">volatile</span> <span class="keywordtype">void</span> *<a class="code" href="group__group__avr32__drivers__flashc.html#ga9ab40621c7f4c7372cb3147c014d7d27" title="Copies nbytes bytes to the flash destination pointed to by dst from the repeated src big-endian sourc...">flashc_memset64</a>(<span class="keyword">volatile</span> <span class="keywordtype">void</span> *dst, uint64_t src, <span class="keywordtype">size_t</span> nbytes, <span class="keywordtype">bool</span> erase)
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720     <span class="comment">// Use aggregated pointers to have several alignments available for a same address.</span>
<a name="l00721"></a>00721     <a class="code" href="union_union_c_v_ptr.html" title="Union of pointers to constant volatile 64-, 32-, 16- and 8-bit unsigned integers.">UnionCVPtr</a> flash_array_end;
<a name="l00722"></a>00722     <a class="code" href="union_union_v_ptr.html" title="Union of pointers to volatile 64-, 32-, 16- and 8-bit unsigned integers.">UnionVPtr</a> dest;
<a name="l00723"></a>00723     <a class="code" href="union_union64.html" title="64-bit union.">Union64</a> source = {0};
<a name="l00724"></a>00724     <a class="code" href="struct_struct_c_v_ptr.html" title="Structure of pointers to constant volatile 64-, 32-, 16- and 8-bit unsigned integers.">StructCVPtr</a> dest_end;
<a name="l00725"></a>00725     <a class="code" href="union_union_c_v_ptr.html" title="Union of pointers to constant volatile 64-, 32-, 16- and 8-bit unsigned integers.">UnionCVPtr</a> flash_page_source_end;
<a name="l00726"></a>00726     <span class="keywordtype">bool</span> incomplete_flash_page_end;
<a name="l00727"></a>00727     <a class="code" href="union_union64.html" title="64-bit union.">Union64</a> flash_dword;
<a name="l00728"></a>00728     <a class="code" href="union_union_v_ptr.html" title="Union of pointers to volatile 64-, 32-, 16- and 8-bit unsigned integers.">UnionVPtr</a> tmp;
<a name="l00729"></a>00729     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00730"></a>00730     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">// Reformat arguments.</span>
<a name="l00733"></a>00733     flash_array_end.<a class="code" href="union_union_c_v_ptr.html#ae30b8d90cf4023021a2ae90829d783b9">u8ptr</a> = AVR32_FLASH + <a class="code" href="group__group__avr32__drivers__flashc.html#ga8071c315b02d038c49fa0bf89a40ba1b" title="Gets the size of the whole flash array.">flashc_get_flash_size</a>();
<a name="l00734"></a>00734     dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = dst;
<a name="l00735"></a>00735     <span class="keywordflow">for</span> (i = (<a class="code" href="compiler_8h.html#a526bddb313be14057f5d65e199f6d814" title="Gets alignment of the number val with respect to the n boundary.">Get_align</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t)) - 1) &amp; (<span class="keyword">sizeof</span>(uint64_t) - 1);
<a name="l00736"></a>00736             src; i = (i - 1) &amp; (<span class="keyword">sizeof</span>(uint64_t) - 1)) {
<a name="l00737"></a>00737         source.<a class="code" href="union_union64.html#af6c6dafc0f068fe37b06e2f4c73184c4">u8</a>[i] = src;
<a name="l00738"></a>00738         src &gt;&gt;= 8;
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740     dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> = dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> + nbytes;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <span class="comment">// If destination is outside flash, go to next flash page if any.</span>
<a name="l00743"></a>00743     <span class="keywordflow">if</span> (dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &lt; AVR32_FLASH) {
<a name="l00744"></a>00744         dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = AVR32_FLASH;
<a name="l00745"></a>00745     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flash_array_end.<a class="code" href="union_union_c_v_ptr.html#ae30b8d90cf4023021a2ae90829d783b9">u8ptr</a> &lt;= dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &amp;&amp; dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &lt; AVR32_FLASHC_USER_PAGE) {
<a name="l00746"></a>00746         dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = AVR32_FLASHC_USER_PAGE;
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <span class="comment">// If end of destination is outside flash, move it to the end of the previous flash page if any.</span>
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> &gt; AVR32_FLASHC_USER_PAGE + AVR32_FLASHC_USER_PAGE_SIZE) {
<a name="l00751"></a>00751         dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> = AVR32_FLASHC_USER_PAGE + AVR32_FLASHC_USER_PAGE_SIZE;
<a name="l00752"></a>00752     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (AVR32_FLASHC_USER_PAGE &gt;= dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> &amp;&amp; dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> &gt; flash_array_end.<a class="code" href="union_union_c_v_ptr.html#ae30b8d90cf4023021a2ae90829d783b9">u8ptr</a>) {
<a name="l00753"></a>00753         dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a> = flash_array_end.<a class="code" href="union_union_c_v_ptr.html#ae30b8d90cf4023021a2ae90829d783b9">u8ptr</a>;
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">// Align each end of destination pointer with its natural boundary.</span>
<a name="l00757"></a>00757     dest_end.<a class="code" href="struct_struct_c_v_ptr.html#a7f767f45320067a836c24f092f133b1c">u16ptr</a> = (uint16_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>, <span class="keyword">sizeof</span>(uint16_t));
<a name="l00758"></a>00758     dest_end.<a class="code" href="struct_struct_c_v_ptr.html#a8b3e4acbf9aa9e133195d9f3da7e1067">u32ptr</a> = (uint32_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#a7f767f45320067a836c24f092f133b1c">u16ptr</a>, <span class="keyword">sizeof</span>(uint32_t));
<a name="l00759"></a>00759     dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aac7addfa477ae9ae941add494152e94b">u64ptr</a> = (uint64_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#a8b3e4acbf9aa9e133195d9f3da7e1067">u32ptr</a>, <span class="keyword">sizeof</span>(uint64_t));
<a name="l00760"></a>00760 
<a name="l00761"></a>00761     <span class="comment">// While end of destination is not reached...</span>
<a name="l00762"></a>00762     <span class="keywordflow">while</span> (dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &lt; dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>) {
<a name="l00763"></a>00763         <span class="comment">// Clear the page buffer in order to prepare data for a flash page write.</span>
<a name="l00764"></a>00764         <a class="code" href="group__group__avr32__drivers__flashc.html#gaffafe9cb74731d817b721d2a52093412" title="Clears the page buffer.">flashc_clear_page_buffer</a>();
<a name="l00765"></a>00765         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767         <span class="comment">// Determine where the source data will end in the current flash page.</span>
<a name="l00768"></a>00768         flash_page_source_end.<a class="code" href="union_union_c_v_ptr.html#a21c8e70e260cbcfa6b1bcd5e36a65cc9">u64ptr</a> =
<a name="l00769"></a>00769                 (uint64_t *)<a class="code" href="compiler_8h.html#ac6afabdc09a49a433ee19d8a9486056d" title="Takes the minimal value of a and b.">min</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aac7addfa477ae9ae941add494152e94b">u64ptr</a>,
<a name="l00770"></a>00770                 <a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, AVR32_FLASHC_PAGE_SIZE) + AVR32_FLASHC_PAGE_SIZE);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">// Determine if the current destination page has an incomplete end.</span>
<a name="l00773"></a>00773         incomplete_flash_page_end = (<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, AVR32_FLASHC_PAGE_SIZE) &gt;=
<a name="l00774"></a>00774                 <a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>, AVR32_FLASHC_PAGE_SIZE));
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="comment">// Use a flash double-word buffer to manage unaligned accesses.</span>
<a name="l00777"></a>00777         flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a> = source.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <span class="comment">// If destination does not point to the beginning of the current flash page...</span>
<a name="l00780"></a>00780         <span class="keywordflow">if</span> (!<a class="code" href="compiler_8h.html#ad490b657cb147d3d1773f6559559b98b" title="Tests alignment of the number val with the n boundary.">Test_align</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, AVR32_FLASHC_PAGE_SIZE)) {
<a name="l00781"></a>00781             <span class="comment">// Fill the beginning of the page buffer with the current flash page data.</span>
<a name="l00782"></a>00782             <span class="comment">// This is required by the hardware, even if page erase is not requested,</span>
<a name="l00783"></a>00783             <span class="comment">// in order to be able to write successfully to erased parts of flash</span>
<a name="l00784"></a>00784             <span class="comment">// pages that have already been written to.</span>
<a name="l00785"></a>00785             <span class="keywordflow">for</span> (tmp.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = (uint8_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, AVR32_FLASHC_PAGE_SIZE);
<a name="l00786"></a>00786                     tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a> &lt; (uint64_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t));
<a name="l00787"></a>00787                     tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>++) {
<a name="l00788"></a>00788                 *tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a> = *tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>;
<a name="l00789"></a>00789             }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791             <span class="comment">// If destination is not 64-bit aligned...</span>
<a name="l00792"></a>00792             <span class="keywordflow">if</span> (!<a class="code" href="compiler_8h.html#ad490b657cb147d3d1773f6559559b98b" title="Tests alignment of the number val with the n boundary.">Test_align</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t))) {
<a name="l00793"></a>00793                 <span class="comment">// Fill the beginning of the flash double-word buffer with the current</span>
<a name="l00794"></a>00794                 <span class="comment">// flash page data.</span>
<a name="l00795"></a>00795                 <span class="comment">// This is required by the hardware, even if page erase is not</span>
<a name="l00796"></a>00796                 <span class="comment">// requested, in order to be able to write successfully to erased parts</span>
<a name="l00797"></a>00797                 <span class="comment">// of flash pages that have already been written to.</span>
<a name="l00798"></a>00798                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="compiler_8h.html#a526bddb313be14057f5d65e199f6d814" title="Gets alignment of the number val with respect to the n boundary.">Get_align</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t)); i++) {
<a name="l00799"></a>00799                     flash_dword.<a class="code" href="union_union64.html#af6c6dafc0f068fe37b06e2f4c73184c4">u8</a>[i] = *tmp.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>++;
<a name="l00800"></a>00800                 }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802                 <span class="comment">// Align the destination pointer with its 64-bit boundary.</span>
<a name="l00803"></a>00803                 dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a> = (uint64_t *)<a class="code" href="compiler_8h.html#a1070d94a69b4e1955ac1723b4f382095" title="Aligns the number val with the lower n boundary.">Align_down</a>((uint32_t)dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t));
<a name="l00804"></a>00804 
<a name="l00805"></a>00805                 <span class="comment">// If the current destination double-word is not the last one...</span>
<a name="l00806"></a>00806                 <span class="keywordflow">if</span> (dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a> &lt; dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aac7addfa477ae9ae941add494152e94b">u64ptr</a>) {
<a name="l00807"></a>00807                     <span class="comment">// Write the flash double-word buffer to the page buffer and reinitialize it.</span>
<a name="l00808"></a>00808                     *dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>++ = flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00809"></a>00809                     flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a> = source.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00810"></a>00810                 }
<a name="l00811"></a>00811             }
<a name="l00812"></a>00812         }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814         <span class="comment">// Write the source data to the page buffer with 64-bit alignment.</span>
<a name="l00815"></a>00815         <span class="keywordflow">for</span> (i = flash_page_source_end.<a class="code" href="union_union_c_v_ptr.html#a21c8e70e260cbcfa6b1bcd5e36a65cc9">u64ptr</a> - dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>; i; i--) {
<a name="l00816"></a>00816             *dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>++ = source.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         <span class="comment">// If the current destination page has an incomplete end...</span>
<a name="l00820"></a>00820         <span class="keywordflow">if</span> (incomplete_flash_page_end) {
<a name="l00821"></a>00821             <span class="comment">// This is required by the hardware, even if page erase is not requested,</span>
<a name="l00822"></a>00822             <span class="comment">// in order to be able to write successfully to erased parts of flash</span>
<a name="l00823"></a>00823             <span class="comment">// pages that have already been written to.</span>
<a name="l00824"></a>00824             {
<a name="l00825"></a>00825                 tmp.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = (<span class="keyword">volatile</span> uint8_t *)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827                 <span class="comment">// If end of destination is not 64-bit aligned...</span>
<a name="l00828"></a>00828                 if (!<a class="code" href="compiler_8h.html#ad490b657cb147d3d1773f6559559b98b" title="Tests alignment of the number val with the n boundary.">Test_align</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t))) {
<a name="l00829"></a>00829                     <span class="comment">// Fill the end of the flash double-word buffer with the current flash page data.</span>
<a name="l00830"></a>00830                     <span class="keywordflow">for</span> (i = <a class="code" href="compiler_8h.html#a526bddb313be14057f5d65e199f6d814" title="Gets alignment of the number val with respect to the n boundary.">Get_align</a>((uint32_t)dest_end.<a class="code" href="struct_struct_c_v_ptr.html#aa3713e0a7260185261a205f121081aca">u8ptr</a>, <span class="keyword">sizeof</span>(uint64_t)); i &lt; <span class="keyword">sizeof</span>(uint64_t); i++)
<a name="l00831"></a>00831                         flash_dword.<a class="code" href="union_union64.html#af6c6dafc0f068fe37b06e2f4c73184c4">u8</a>[i] = *tmp.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a>++;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833                     <span class="comment">// Write the flash double-word buffer to the page buffer.</span>
<a name="l00834"></a>00834                     *dest.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>++ = flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00835"></a>00835                 }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837                 <span class="comment">// Fill the end of the page buffer with the current flash page data.</span>
<a name="l00838"></a>00838                 <span class="keywordflow">for</span> (; !<a class="code" href="compiler_8h.html#ad490b657cb147d3d1773f6559559b98b" title="Tests alignment of the number val with the n boundary.">Test_align</a>((uint32_t)tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>, AVR32_FLASHC_PAGE_SIZE); tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>++) {
<a name="l00839"></a>00839                     *tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a> = *tmp.<a class="code" href="union_union_v_ptr.html#add94692ec8e633ed9efc32a0b4134a66">u64ptr</a>;
<a name="l00840"></a>00840                 }
<a name="l00841"></a>00841             }
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844         <span class="comment">// If the current flash page is in the flash array...</span>
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &lt;= AVR32_FLASHC_USER_PAGE) {
<a name="l00846"></a>00846             <span class="comment">// Erase the current page if requested and write it from the page buffer.</span>
<a name="l00847"></a>00847             <span class="keywordflow">if</span> (erase) {
<a name="l00848"></a>00848                 <a class="code" href="group__group__avr32__drivers__flashc.html#ga8bd196144d3485a9b50b7c5fffc9fab2" title="Erases a page.">flashc_erase_page</a>(-1, <span class="keyword">false</span>);
<a name="l00849"></a>00849                 error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00850"></a>00850             }
<a name="l00851"></a>00851             <a class="code" href="group__group__avr32__drivers__flashc.html#gaa10438433246139bee71da6db2bb5bd5" title="Writes a page from the page buffer.">flashc_write_page</a>(-1);
<a name="l00852"></a>00852             error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854             <span class="comment">// If the end of the flash array is reached, go to the User page.</span>
<a name="l00855"></a>00855             <span class="keywordflow">if</span> (dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> &gt;= flash_array_end.<a class="code" href="union_union_c_v_ptr.html#ae30b8d90cf4023021a2ae90829d783b9">u8ptr</a>) {
<a name="l00856"></a>00856                 dest.<a class="code" href="union_union_v_ptr.html#adae0fe80c386b7283d072757309557f0">u8ptr</a> = AVR32_FLASHC_USER_PAGE;
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858         } <span class="keywordflow">else</span> {
<a name="l00859"></a>00859             <span class="comment">// Erase the User page if requested and write it from the page buffer.</span>
<a name="l00860"></a>00860             <span class="keywordflow">if</span> (erase) {
<a name="l00861"></a>00861                 <a class="code" href="group__group__avr32__drivers__flashc.html#ga7160c001cada0a9a0162cac2305a9038" title="Erases the User page.">flashc_erase_user_page</a>(<span class="keyword">false</span>);
<a name="l00862"></a>00862                 error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00863"></a>00863             }
<a name="l00864"></a>00864             <a class="code" href="group__group__avr32__drivers__flashc.html#gad04374b721dca9c534d7cd041ae24712" title="Writes the User page from the page buffer.">flashc_write_user_page</a>();
<a name="l00865"></a>00865             error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00866"></a>00866         }
<a name="l00867"></a>00867     }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     <span class="comment">// Update the FLASHC error status.</span>
<a name="l00870"></a>00870     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <span class="comment">// Return the initial destination pointer as the standard memset function does.</span>
<a name="l00873"></a>00873     <span class="keywordflow">return</span> dst;
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 
<a name="l00877"></a><a class="code" href="group__group__avr32__drivers__flashc.html#ga342404f6e3f2757138c8dc58916ffef1">00877</a> <span class="keyword">volatile</span> <span class="keywordtype">void</span> *<a class="code" href="group__group__avr32__drivers__flashc.html#ga342404f6e3f2757138c8dc58916ffef1" title="Copies nbytes bytes to the flash destination pointed to by dst from the source pointed to by src...">flashc_memcpy</a>(<span class="keyword">volatile</span> <span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">size_t</span> nbytes, <span class="keywordtype">bool</span> erase)
<a name="l00878"></a>00878 {
<a name="l00879"></a>00879     uint16_t page_pos;
<a name="l00880"></a>00880     <a class="code" href="union_union64.html" title="64-bit union.">Union64</a> flash_dword;
<a name="l00881"></a>00881     uint8_t i;
<a name="l00882"></a>00882     <span class="keywordtype">bool</span> b_user_page;
<a name="l00883"></a>00883     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> error_status = 0;
<a name="l00884"></a>00884     uint8_t* flash_add;
<a name="l00885"></a>00885     uint8_t* dest_add=(uint8_t*)dst;
<a name="l00886"></a>00886     <span class="keyword">const</span> uint8_t* src_buf=(<span class="keyword">const</span> uint8_t*)src;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="comment">// Copy area must be in flash array or flash user page</span>
<a name="l00889"></a>00889     <a class="code" href="compiler_8h.html#aab1e54dcc40192f9704e8b252635450f" title="This macro is used to test fatal errors.">Assert</a>( (((uint8_t *)dst &gt;= AVR32_FLASH)
<a name="l00890"></a>00890             &amp;&amp; (((uint8_t *)dst + nbytes) &lt;= (AVR32_FLASH + <a class="code" href="group__group__avr32__drivers__flashc.html#ga8071c315b02d038c49fa0bf89a40ba1b" title="Gets the size of the whole flash array.">flashc_get_flash_size</a>())))
<a name="l00891"></a>00891             || (((uint8_t *)dst &gt;= AVR32_FLASHC_USER_PAGE)
<a name="l00892"></a>00892             &amp;&amp; (((uint8_t *)dst + nbytes) &lt;= (AVR32_FLASHC_USER_PAGE + AVR32_FLASHC_USER_PAGE_SIZE))) );
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     b_user_page = (<span class="keyword">volatile</span> uint8_t *)dst &gt;= AVR32_FLASHC_USER_PAGE;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     flash_add = (uint8_t*)((uint32_t)dest_add - ((uint32_t)dest_add % AVR32_FLASHC_PAGE_SIZE));
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <span class="keywordflow">while</span> (nbytes) {
<a name="l00899"></a>00899         <span class="comment">// Clear the page buffer in order to prepare data for a flash page write.</span>
<a name="l00900"></a>00900         <a class="code" href="group__group__avr32__drivers__flashc.html#gaffafe9cb74731d817b721d2a52093412" title="Clears the page buffer.">flashc_clear_page_buffer</a>();
<a name="l00901"></a>00901         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         <span class="comment">// Loop in the page</span>
<a name="l00904"></a>00904         <span class="keywordflow">for</span> (page_pos=0; page_pos&lt;AVR32_FLASHC_PAGE_SIZE; page_pos+=<span class="keyword">sizeof</span>(uint64_t) ) {
<a name="l00905"></a>00905             <span class="comment">// Read the flash double-word buffer</span>
<a name="l00906"></a>00906             flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a> = *(<span class="keyword">volatile</span> uint64_t*)flash_add;
<a name="l00907"></a>00907 
<a name="l00908"></a>00908             <span class="comment">// Update double-word if necessary</span>
<a name="l00909"></a>00909             <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(uint64_t); i++) {
<a name="l00910"></a>00910                 <span class="keywordflow">if</span> (nbytes &amp;&amp; (flash_add == dest_add)) {
<a name="l00911"></a>00911                     <span class="comment">// Update page with data source</span>
<a name="l00912"></a>00912                     flash_dword.<a class="code" href="union_union64.html#af6c6dafc0f068fe37b06e2f4c73184c4">u8</a>[i] = *src_buf++;
<a name="l00913"></a>00913                     dest_add++;
<a name="l00914"></a>00914                     nbytes--;
<a name="l00915"></a>00915                 }
<a name="l00916"></a>00916                 flash_add++;
<a name="l00917"></a>00917             }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919             <span class="comment">// Write the flash double-word buffer to the page buffer.</span>
<a name="l00920"></a>00920             *(<span class="keyword">volatile</span> uint64_t*)((uint32_t)flash_add - <span class="keyword">sizeof</span>(uint64_t))= flash_dword.<a class="code" href="union_union64.html#aac95b1d1211f52003bbc09498393ee0d">u64</a>;
<a name="l00921"></a>00921         }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923         <span class="comment">// Erase the current page if requested and write it from the page buffer.</span>
<a name="l00924"></a>00924         <span class="keywordflow">if</span> (erase) {
<a name="l00925"></a>00925             (b_user_page)? <a class="code" href="group__group__avr32__drivers__flashc.html#ga7160c001cada0a9a0162cac2305a9038" title="Erases the User page.">flashc_erase_user_page</a>(<span class="keyword">false</span>) : <a class="code" href="group__group__avr32__drivers__flashc.html#ga8bd196144d3485a9b50b7c5fffc9fab2" title="Erases a page.">flashc_erase_page</a>(-1, <span class="keyword">false</span>);
<a name="l00926"></a>00926             error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00927"></a>00927         }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929         <span class="comment">// Write the page</span>
<a name="l00930"></a>00930         (b_user_page)? <a class="code" href="group__group__avr32__drivers__flashc.html#gad04374b721dca9c534d7cd041ae24712" title="Writes the User page from the page buffer.">flashc_write_user_page</a>() : <a class="code" href="group__group__avr32__drivers__flashc.html#gaa10438433246139bee71da6db2bb5bd5" title="Writes a page from the page buffer.">flashc_write_page</a>(-1);
<a name="l00931"></a>00931         error_status |= <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a>;
<a name="l00932"></a>00932     }
<a name="l00933"></a>00933     <span class="comment">// Update the FLASHC error status.</span>
<a name="l00934"></a>00934     <a class="code" href="group__group__avr32__drivers__flashc.html#gaf22dcfb635e7fa6bf926dc810e40d6be" title="Sticky error status of the FLASHC.">flashc_error_status</a> = error_status;
<a name="l00935"></a>00935 
<a name="l00936"></a>00936     <span class="comment">// Return the initial destination pointer as the standard memcpy function does.</span>
<a name="l00937"></a>00937     <span class="keywordflow">return</span> dst;
<a name="l00938"></a>00938 }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940 
<a name="l00941"></a>00941 <span class="preprocessor">#if UC3C</span>
<a name="l00942"></a>00942 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__group__avr32__drivers__flashc.html#gaa943e0ec113449ecf316740b45426880" title="Depednding to the CPU frequency, set the wait states of flash read accesses and enable or disable the...">flashc_set_flash_waitstate_and_readmode</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cpu_f_hz)
<a name="l00943"></a>00943 {
<a name="l00945"></a>00945 <span class="preprocessor">    #undef AVR32_FLASHC_FWS_0_MAX_FREQ</span>
<a name="l00946"></a>00946 <span class="preprocessor"></span><span class="preprocessor">    #undef AVR32_FLASHC_FWS_1_MAX_FREQ</span>
<a name="l00947"></a>00947 <span class="preprocessor"></span><span class="preprocessor">    #undef AVR32_FLASHC_HSEN_FWS_0_MAX_FREQ</span>
<a name="l00948"></a>00948 <span class="preprocessor"></span><span class="preprocessor">    #undef AVR32_FLASHC_HSEN_FWS_1_MAX_FREQ</span>
<a name="l00949"></a>00949 <span class="preprocessor"></span><span class="preprocessor">    #define AVR32_FLASHC_FWS_0_MAX_FREQ           33000000</span>
<a name="l00950"></a>00950 <span class="preprocessor"></span><span class="preprocessor">    #define AVR32_FLASHC_FWS_1_MAX_FREQ           66000000</span>
<a name="l00951"></a>00951 <span class="preprocessor"></span><span class="preprocessor">    #define AVR32_FLASHC_HSEN_FWS_0_MAX_FREQ      33000000</span>
<a name="l00952"></a>00952 <span class="preprocessor"></span><span class="preprocessor">    #define AVR32_FLASHC_HSEN_FWS_1_MAX_FREQ      72000000</span>
<a name="l00953"></a>00953 <span class="preprocessor"></span>    <span class="comment">// These defines are missing from or wrong in the toolchain header files uc3cxxx.h</span>
<a name="l00954"></a>00954     <span class="comment">// Put a Bugzilla</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <span class="keywordflow">if</span> (cpu_f_hz &gt; AVR32_FLASHC_HSEN_FWS_0_MAX_FREQ) { <span class="comment">// &gt; 33MHz</span>
<a name="l00957"></a>00957         <span class="comment">// Set a wait-state</span>
<a name="l00958"></a>00958         <a class="code" href="pm__conf__clocks_8c.html#a2835c7ef58f410290ad530d34d7e8133">flashc_set_wait_state</a>(1);
<a name="l00959"></a>00959         <span class="keywordflow">if</span> (cpu_f_hz &lt;= AVR32_FLASHC_FWS_1_MAX_FREQ) {   <span class="comment">// &lt;= 66MHz and &gt;33Mhz</span>
<a name="l00960"></a>00960             <span class="comment">// Disable the high-speed read mode.</span>
<a name="l00961"></a>00961             <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_HSDIS, -1);
<a name="l00962"></a>00962         } <span class="keywordflow">else</span> { <span class="comment">// &gt; 66Mhz</span>
<a name="l00963"></a>00963             <span class="comment">// Enable the high-speed read mode.</span>
<a name="l00964"></a>00964             <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_HSEN, -1);
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966     } <span class="keywordflow">else</span> { <span class="comment">// &lt;= 33 MHz</span>
<a name="l00967"></a>00967         <span class="comment">// Disable wait-state</span>
<a name="l00968"></a>00968         <a class="code" href="pm__conf__clocks_8c.html#a2835c7ef58f410290ad530d34d7e8133">flashc_set_wait_state</a>(0);
<a name="l00969"></a>00969         <span class="comment">// Disable the high-speed read mode.</span>
<a name="l00970"></a>00970         <a class="code" href="group__group__avr32__drivers__flashc.html#ga8045c427c32cf3617e861067d76c9c11" title="Issues a FLASHC command.">flashc_issue_command</a>(AVR32_FLASHC_FCMD_CMD_HSDIS, -1);
<a name="l00971"></a>00971     }
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 <span class="preprocessor">#endif // UC3C device-specific implementation</span>
<a name="l00974"></a>00974 <span class="preprocessor"></span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Dec 15 2011 13:05:46 for OS by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
