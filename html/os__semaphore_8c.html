<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>eeOS (Embedded Event-driven Operating System): os_semaphore.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>os_semaphore.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>eeOS Semaphores  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="os__core_8h_source.html">os_core.h</a>&quot;</code><br/>

<p><a href="os__semaphore_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="os__event_8h.html#a9658f0b4244c28dcd0efdcdbb2109fd7">os_event_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="os__semaphore_8c.html#a36f67e77741bcfc3affdf7ae4f05bacc">__os_event_sempahore_is_triggered</a> (struct <a class="el" href="structos__process.html">os_process</a> *proc, <a class="el" href="os__port_8h.html#a0c6bdb0cfe9a04a4942b875a52958fc9">os_ptr_t</a> args)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Event trigger function. Take the semphore, use by the event.  <a href="#a36f67e77741bcfc3affdf7ae4f05bacc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__os__public__api.html#ga93796eb1fdad55b62be5de91fccb7952">os_semaphore_release</a> (struct <a class="el" href="structos__semaphore.html">os_semaphore</a> *sem)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Releases a semaphore.  <a href="group__group__os__public__api.html#ga93796eb1fdad55b62be5de91fccb7952"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__os__public__api.html#ga14089e1d955db03a545cdca18de265e2">os_semaphore_take</a> (struct <a class="el" href="structos__semaphore.html">os_semaphore</a> *sem)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Take a semaphore. If no semaphore is available, wait until it gets free.  <a href="group__group__os__public__api.html#ga14089e1d955db03a545cdca18de265e2"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>eeOS Semaphores </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Blaise Lengrand (<a href="mailto:blaise.lengrand@gmail.com">blaise.lengrand@gmail.com</a>) </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>0.1 </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011</dd></dl>
<h2><a class="anchor" id="eeos_license"></a>
License</h2>
<p><a class="el" href="group__group__os.html">eeOS</a> is provided in source form for FREE evaluation, for educational use or for peaceful research. If you plan on using <a class="el" href="group__group__os.html">eeOS</a> in a commercial product you need to contact the author to properly license its use in your product. The fact that the source is provided does NOT mean that you can use it without paying a licensing fee. </p>

<p>Definition in file <a class="el" href="os__semaphore_8c_source.html">os_semaphore.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a36f67e77741bcfc3affdf7ae4f05bacc"></a><!-- doxytag: member="os_semaphore.c::__os_event_sempahore_is_triggered" ref="a36f67e77741bcfc3affdf7ae4f05bacc" args="(struct os_process *proc, os_ptr_t args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="os__event_8h.html#a9658f0b4244c28dcd0efdcdbb2109fd7">os_event_status</a> __os_event_sempahore_is_triggered </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structos__process.html">os_process</a> *&nbsp;</td>
          <td class="paramname"> <em>proc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="os__port_8h.html#a0c6bdb0cfe9a04a4942b875a52958fc9">os_ptr_t</a>&nbsp;</td>
          <td class="paramname"> <em>args</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Event trigger function. Take the semphore, use by the event. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>proc</em>&nbsp;</td><td>The process waiting for the event. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>Extra arguments send with this event. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>OS_EVENT_NONE if no ressource is available. OS_EVENT_OK_STOP if only 1 is available, OS_EVENT_OK_CONTINUE if more than one. </dd></dl>

<p>Definition at line <a class="el" href="os__semaphore_8c_source.html#l00017">17</a> of file <a class="el" href="os__semaphore_8c_source.html">os_semaphore.c</a>.</p>

<p>References <a class="el" href="os__semaphore_8h_source.html#l00047">os_semaphore::counter</a>, <a class="el" href="os__port_8h_source.html#l00065">os_enter_critical()</a>, <a class="el" href="os__port_8h_source.html#l00073">os_is_critical()</a>, <a class="el" href="os__port_8h_source.html#l00069">os_leave_critical()</a>, and <a class="el" href="os__core_8h_source.html#l00439">os_process::status</a>.</p>

<p>Referenced by <a class="el" href="os__semaphore_8h_source.html#l00106">os_semaphore_create_event()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">/* Initial status set to &quot;no event&quot; */</span>
    <span class="keyword">enum</span> <a class="code" href="os__event_8h.html#a9658f0b4244c28dcd0efdcdbb2109fd7" title="Status returned by an event.">os_event_status</a> status = OS_EVENT_NONE;
    <span class="comment">/* Cast the arguments into a os_semaphore structure */</span>
    <span class="keyword">struct </span><a class="code" href="structos__semaphore.html" title="Semaphore Structure.">os_semaphore</a> *sem = (<span class="keyword">struct </span><a class="code" href="structos__semaphore.html" title="Semaphore Structure.">os_semaphore</a> *) args;
    <span class="comment">/* Save the critical region status */</span>
    <span class="keywordtype">bool</span> is_critical = <a class="code" href="group__os__port__group.html#ga3409b487193b6c7fd877bc2f9c5b218a" title="Indicates if the CPU is currently running inside a critical region.">os_is_critical</a>();

    <span class="comment">/* Enter in a critical region if not already in */</span>
    <span class="keywordflow">if</span> (!is_critical) {
        <a class="code" href="group__os__port__group.html#ga8c5be06e8a791ac257e372d19a41e527" title="Start of a critical code region. Preemptive context switches cannot occur when in a critical region...">os_enter_critical</a>();
    }
    <span class="comment">/* If there is only 1 semaphore left */</span>
    <span class="keywordflow">if</span> (sem-&gt;<a class="code" href="structos__semaphore.html#a364613c00601ce45b100fd208832d817" title="Counter to hold the current number of free semaphores.">counter</a> == 1) {
        <span class="comment">/* Take it */</span>
        sem-&gt;<a class="code" href="structos__semaphore.html#a364613c00601ce45b100fd208832d817" title="Counter to hold the current number of free semaphores.">counter</a> = 0;
        <span class="comment">/* It is the last semaphore so no further check is necessary */</span>
        status = OS_EVENT_OK_STOP;
    }
    <span class="comment">/* If there is more than 1 semaphore available */</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sem-&gt;<a class="code" href="structos__semaphore.html#a364613c00601ce45b100fd208832d817" title="Counter to hold the current number of free semaphores.">counter</a> &gt; 1) {
        <span class="comment">/* Take it */</span>
        sem-&gt;<a class="code" href="structos__semaphore.html#a364613c00601ce45b100fd208832d817" title="Counter to hold the current number of free semaphores.">counter</a>--;
        <span class="comment">/* Another process can be triggered with this sempahore, so</span>
<span class="comment">         * set the status as &quot;continue&quot;</span>
<span class="comment">         */</span>
        status = OS_EVENT_OK_CONTINUE;
    }
    <span class="comment">/* Leave the critical region */</span>
    <span class="keywordflow">if</span> (!is_critical) {
        <a class="code" href="group__os__port__group.html#ga1ed5e871f1b9707aafedd8f97d9d6524" title="Exit a critical code region. .">os_leave_critical</a>();
    }

    <span class="keywordflow">return</span> status;
}
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Feb 29 2012 13:12:56 for eeOS (Embedded Event-driven Operating System) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
